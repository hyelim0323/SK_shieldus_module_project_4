<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>공감 AI 챗봇</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"
        integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
    {# jQuery CDN #}
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"
        integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
    {# 클라이언트의 정보를 클라이언트측에 저장시키겠다 => '쿠키'(서버/클라이언트모두저장),
    웹스토리지(로컬,세션), 웹DB #}
    {# jQuery-cookies CDN #}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"
        integrity="sha512-3j3VU6WC5rPQB4Ld1jnLV7Kd5xr+cq9avvhwqzbH/taCRNURoeEpoPBK9pDyeukwSxwRPJ8fDgvYXd6SkaZ2TA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        body {
            display: flex;
            align-items: center;
            padding-top: 30px;
            padding-bottom: 30px;
            background-color: #fffdd4;
        }
    </style>
</head>

<body>
    <div class="container" style="padding-top: 70px; max-width: 800px">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">회원가입</div>
                    <div class="card-body">
                        <div class="form-horizontal" id="signup-form" method="post" action="#">
                            <div class="form-group">
                                <label for="uid" class="cols-sm-2 control-label">아이디</label>
                                <div class="cols-sm-10">
                                    <div class="input-group" style="margin-bottom: 5px;">
                                        <span class="input-group-addon"><i class="fa fa-user fa"
                                                aria-hidden="true"></i></span>
                                        <input type="text" class="form-control" name="uid" id="uid"
                                            placeholder="Enter your Id" />
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="password" class="cols-sm-2 control-label">비밀번호</label>
                                <div class="cols-sm-10">
                                    <div class="input-group" style="margin-bottom: 5px;">
                                        <span class="input-group-addon"><i class="fa fa-lock fa-lg"
                                                aria-hidden="true"></i></span>
                                        <input type="password" class="form-control" name="password" id="password"
                                            placeholder="Enter your Password" />
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="chatbot_name" class="cols-sm-2 control-label">챗봇 이름</label>
                                <div class="cols-sm-10">
                                    <div class="input-group" style="margin-bottom: 5px;">
                                        <span class="input-group-addon"><i class="fa fa-users fa"
                                                aria-hidden="true"></i></span>
                                        <input type="text" class="form-control" name="chatbot_name" id="chatbot_name"
                                            placeholder="Enter your Chatbot Name" />
                                    </div>
                                </div>
                            </div>
                            <!-- 선택박스 (말투선택) -->
                            <div class="form-group">
                                <label for="chatbot_accent" class="cols-sm-2 control-label">챗봇 말투</label>
                                <div class="cols-sm-10">
                                    <div class="input-group" style="margin-bottom: 5px;">
                                        <select class="form-select" id="chatbot_accent" aria-label="select example" ,
                                            style="width:100%;">
                                            <option selected>Select your Chatbot Accent</option>
                                            <option value="choding">초등학생</option>
                                            <option value="joongding">중학생</option>
                                            <option value="halbae">할아버지</option>
                                            <option value="halmae">할머니</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <!-- 이미지 업로드 -->
                            <!-- <div class="form-group">
                                <label for="chatbot_image" class="cols-sm-2 control-label">챗봇 프로필 이미지</label>
                                <div class="cols-sm-10">
                                    <div class="input-group" style="margin-bottom: 10px;">
                                        <input type="file" class="form-control" id="chatbot_image"/>

                                    </div>
                                </div>
                            </div> -->
                            <!-- <form method = "POST" enctype = "multipart/form-data">
                                <input type = "file" name = "file" />
                                <input type = "submit"/>
                            </form> -->
                            <!-- 
                            <div class="input-group" style="margin-bottom: 10px;">
                                <input type="file" class="form-control" id="chatbot_image"/>
                            </div> -->

                            <!-- 등록되고 나면 로그인 페이지로 돌아가기 -->
                            <!-- <div class="form-group ">
                                <button id="sign_btn" type="submit"
                                    class="btn btn-primary btn-lg btn-block login-button" style="width: 100%;">가입하기</button>
                            </div> -->
                        </div>
                        <form enctype="multipart/form-data" style="margin-bottom: 5px;"> 
                            <input type="file" name="file" id="imageInput" />
                            <!--<input type="submit" />-->
                        </form>
                        <div class="form-submit ">
                            <button id="sign_btn" type="submit" class="btn btn-primary btn-lg btn-block login-button"
                                style="width: 100%;">가입하기</button>
                        </div>
                        <script>
                            $('#sign_btn').on('click', () => {
                                const imageInput = $("#imageInput")[0];
                                if (imageInput.files.length === 0) {
                                    alert("파일은 선택해주세요");
                                    return;
                                }
                                
                                let uid = $("#uid").val().trim()
                                let upw = $("#password").val().trim()
                                let chatbot_name = $("#chatbot_name").val().trim()
                                let value_str = document.getElementById("chatbot_accent");
                                let accent = value_str.options[value_str.selectedIndex].value

                                if (uid === '' || upw === '' || chatbot_name === '' || accent === 'Select your Chatbot Accent') {
                                    alert("회원 정보를 모두 입력하세요.");
                                    return false
                                }

                                const formData = new FormData();
                                formData.append("file", imageInput.files[0]);
                                formData.append('uid', uid);
                                formData.append('upw', upw);
                                formData.append('cname', chatbot_name);
                                formData.append('caccent', accent);

                                console.log('전송')
                                $.post({
                                    url: '/auth/signup',
                                    data: formData,
                                    cache: false,
                                    contentType: false,
                                    processData: false,
                                    success: res => {
                                        console.log(res)
                                        // res로 id 값 받기
                                        if (res.id) {
                                            // 특정 페이지로 이동
                                            window.location.replace("{{ url_for('auth_bp.login') }}")
                                        } else {
                                            // 토큰 발행 실행
                                            alert(res.msg)
                                        }
                                    },
                                    error: e => {
                                        console.log('전송 오류', e)
                                    }

                                })


                            })
                            $('form').on('submit', e => {
                                e.preventDefault()
                                return false
                            })
                        </script>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>